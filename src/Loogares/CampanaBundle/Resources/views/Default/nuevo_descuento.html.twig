{% extends "LoogaresCampanaBundle:Layout:base_campanas.html.twig" %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/jquery.fancybox.css') }}" type="text/css" media="screen" />
{% endblock %}
{% block content %}

<div class="seguidores">

	<h1 class="titulo_principal">{{seguidores|length}} seguidores de {{lugar.nombre}}</h1>

	<p class="breadcrumb"><a href="#">Inicio</a> » <span class="selected">Mis seguidores</span></p>

	<div class="fitros_seguidores fitros_seguidores_seleccion">
		<ul class="ordenar_por">
			<li class="tipos_de_orden">Ordenar por:</li>
			<li class="tipos_de_orden">
				{#% if orden == 'recomendaciones' %}
					<p class="selected">Nº Recomendaciones</p>
				{#% else %#} 
					<a href="?orden=recomendaciones">Nº Recomendaciones</a>
				{#% endif %#}| 
			</li>
			<li class="tipos_de_orden">
				{#% if orden == 'premios' %}
					<p class="selected">Premios ganados</p>
				{#% else %#} 
					<a href="?orden=premios">Premios ganados</a>
				{#% endif %#}| 
			</li>
			<li class="tipos_de_orden">
				{#% if orden == 'descuentos' %}
					<p class="selected">Descuentos regalados</p>
				{#% else %#} 
					<a href="?orden=descuentos">Descuentos regalados</a>
				{#% endif %#}| 
			</li>
		</ul>
		<form class="filtrar_por">
			{#% if recomendo == null %#}
				<a class="han_recomendado" href="?recomendo">Han recomendado {{lugar.nombre-}}</a>
			{#% else %} 
				<a class="han_recomendado" href="{{ path('_reporte_seguidores', {'slug': lugar.slug, 'comuna': comuna|default(null), 'orden': orden}) }}">Ver todos los seguidores</a>
			{#% endif %#}| 
			<select class="comunas" name="comuna" style="width: 220px">
				<option value="todas">Todas</option>
				{% for comuna in comunas %}
					<option {% if comuna.usuario.comuna.slug == filtrado %}selected="selected"{% endif %}value="{{comuna.usuario.comuna.slug}}">{{comuna.usuario.comuna.nombre}}</option>
				{% endfor %}
			</select>
			<input type="submit" value="filtrar">
		</form>
	</div>

	<div class="seleccionar_todos_ninguno">
		<input type="checkbox" />
		<span class="seleccionar_todos">Seleccionar todos</span>
		<input type="checkbox" />
		<span class="seleccionar_ninguno">Deseleccionar todos</span>
	</div>

	<div class="caja_seguidores seleccion">
		{% for seguidor in seguidores %}
		<input type="checkbox" value="{{seguidor.usuario.slug}}" class="seguidores_checkbox" name="seguidores[]" />
		<div class="seguidor">
			<div class="seguidor_imagen">
				<img src="{#{ ('assets/images/usuarios/'~seguidor.usuarioImagen) | apply_filter('tiny_usuario')}#}" height="30" width="30" />
			</div>
			<div class="seguidor_datos">
				<a href="#">{% if seguidor.usuario.nombre != '' %} {{seguidor.usuario.nombre}} {{seguidor.usuario.apellido}} {% else %} {{seguidor.usuario.slug}} {% endif %}</a>
				<p class="comuna">{% if seguidor.usuario.comuna %} {{seguidor.usuario.comuna.nombre}} {% endif %}</p>
			</div>
			<div class="seguidor_iconos">
				<div class="numero_recomendaciones">
					<p class="valor">{{seguidor.usuario.recomendaciones|length}}</p>
				</div>
				<div class="numero_descuentos">
					<p class="valor">{#{seguidor.totalDescuentos}#}</p>
				</div>
				<div class="numero_be">
					<p class="valor">{#{seguidor.totalBe}#}</p>
				</div>
				<div class="recomendacion_lugar {#% if seguidor.recomendo %#}si{#% else %}no{% endif %#}">
					<a href="{#{ path('_recomendacion', {'slug': lugar.slug, 'usuarioSlug': seguidor.usuarioSlug }) }#}" target="_blank"></a>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>

	<div class="sidebar">
		<div class="seguidores_sidebar">
			<div class="participantes_concurso">
				<div class="cantidad_participantes_izq"></div>
				<div class="cantidad_participantes seleccionados">
					<span class="numero_participantes numero_seleccionados">0</span> <span class="seguidores_seleccionados">Loogareños seleccionados</span>
				</div>
				<div class="cantidad_participantes_der"></div>
			</div>
			<div class="otorgar_gift"></div>
		</div> 
		<div class="ayuda">
			<div class="fondo_interrogacion"></div>
			<p class="titulo">Necesitas ayuda?</p>
			<p>Contáctanos al <strong>+56 2 724 0993</strong><br/>
				ó escribenos a <a href="mailto:contacto@loogares.com">contacto@loogares.com</a></p>
		</div>
	</div>

<div style="display:none">
	<div class="lolbox">
		<form method="post" class="nuevo_descuento" action="{{ path('_reporte_descuentos_enviar', {'slug': lugar.slug, 'id': id}) }}">
			<div class="step_static">
				<div class="participantes_concurso">
					<div class="cantidad_participantes_izq"></div>
					<div class="cantidad_participantes seleccionados">
						<span class="numero_participantes numero_seleccionados">0</span> <span class="seguidores_seleccionados">Loogareños seleccionados</span>
					</div>
					<div class="cantidad_participantes_der"></div>
				</div>
			</div>
			<div class="step_active">
					<h3>1. ¿Que tipo de descuento quieres regalar? <small></small></h3>
					<div class="step_content">
						<ul class="rango_descuentos">
							{% for dco in [15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90] %}
							<li>
								<input type="radio" value="{{dco}}" name="dco" /> <label>{{dco}}%</label>
							</li>
							{% if loop.index % 6 == 0 %}</ul><ul class="rango_descuentos">{% endif %}
							{% endfor %}
						</ul>
					</div>
			</div>
			<div class="step_hidden">
			    <h3>2. ¿Cuanto tiempo quieres que dure el descuento? <small></small></h3>
			    <div class="step_content">
						<ul class="rango_tiempo">
							<li><input type="radio" value="7" name="tiempo" /> <label>1 Semana</label></li>
							<li><input type="radio" value="14" name="tiempo" /> <label>2 Semanas</label></li>
							<li><input type="radio" value="21" name="tiempo" /> <label>3 Semanas</label></li>
							<li><input type="radio" value="30" name="tiempo" /> <label>1 Mes</label></li>
						</ul>		
					</div>    
			</div>
			<div class="step_hidden">
			    <h3>3. ¿Cuáles son las condiciones de uso del descuento?<small></small></h3>
			    <div class="step_content">
			    	<textarea class="textarea" name="condiciones" placeholder="* Escribe acá todas las restricciones de uso de las Gift Cards por día, tipo de producto, horarios de uso, etc.                                                                                                                           Ej. Sólo canjeable de martes a jueves previa reserva al 2235764."></textarea>
			    	<p class="tip">* Si se deja este campo vacio se considerara su uso dentro del horario normal 
de atención del local.</p>
			    </div>
			</div>
			<div class="step_hidden">
			    <h4>Prepárate...</h4>
			    <div class="step_content">
			    	<p class="tip center">Haz click en el botón y envía tus descuentos ahora:</p>
			    </div>
			</div>
			<div class="step_hidden step_final">
			    <p>¡Felicitaciones tus descuentos han sido enviados con exito!</p>
			</div>
			<input type="button" class="siguiente_paso" value="Seleccionar"/>
		</form>
	</div>​
</div>
{% endblock %}

{% block javascripts %}
  <script src="{{asset('assets/js/jquery.fancybox.pack.js')}}"></script>
	<script>
	$('.seguidores_checkbox').change(function(){
		var $this = $(this);
		var $seleccionados = $('.numero_seleccionados');
		var seleccionadosCount = parseInt($seleccionados.html());

		($this.is(':checked'))?seleccionadosCount++:seleccionadosCount--;
		$seleccionados.html(seleccionadosCount)
	});

	$(".otorgar_gift").fancybox({
    type: 'inline',
		content: $('.lolbox'),
		padding: 0,
		fitToView: false
	});

	$('.siguiente_paso').click(function(){
	    $active = $('.step_active');
	    
	    $active.next('div:not(.siguiente_paso)')
	                     .removeClass('step_hidden')
	                     .removeClass('step_done')            
	                     .addClass('step_active');
	                     
	    $active.toggleClass('step_active')
	           .toggleClass('step_done');

	    if($active.find('input[type=radio]').length){
	    	var chosenOption = $active.find('input[type=radio]:checked').next('label').text();
	    }else if($active.find('textarea').length){
	    	var chosenOption = $active.find('textarea').val();
	    }

	    $active.find('h3 > small').text(chosenOption)

	    if($('.step_active').next('div').hasClass('step_final')){
	    	$('.siguiente_paso').val('Enviar');
	    }else{
	    	$('.siguiente_paso').val('Seleccionar')
	    }

	    if($('.step_active').hasClass('step_final')){
	    	$('.siguiente_paso').remove();
	    	$('.nuevo_descuento').append($('input[class=seguidores_checkbox]:checked'))
	    	//$('.nuevo_descuento').submit()
	    	$('.step_done, .step_static').hide();
	    }
	});
	    
	$('.step_done').live('click', function(){            
	    $('.step_active')
	        .removeClass('step_active')
	        .addClass('step_done');
	    $(this)
	        .removeClass('step_done')
	        .addClass('step_active');    
	});


	</script>
{% endblock %}