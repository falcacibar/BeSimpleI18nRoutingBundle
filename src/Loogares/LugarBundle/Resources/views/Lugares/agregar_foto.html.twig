{% extends "::base.html.twig" %}

{% block title %}Agregar foto a {{lugar.nombre}} | {{parent()}}{% endblock %}

{% block content %}
	<div id="agregar_foto_lugar">
		<h1>Agrega foto en <a href="{{path('_lugar', {'slug' : lugar.slug })}}">{{lugar.nombre}}</a></h1>

		<p>Puedes agregar una o más fotos a la galería de fotos de <strong>{{lugar.nombre}}</strong> en sólo 2 pasos:</p>

		{% if errors %}
			<div class="agregar_foto_lugar_error">
				{% for error in errors %}
			        <p>{{ error }}</p>
			    {% endfor %}
			</div>
		{% endif %}

		<div class="agregar_paso_1">
			<p>1. Cargar fotos (sólo JPG, GIF y PNG, máx. 5 MB)</p>


			<form action="{{ path('_agregarFotoLugar', { 'slug' : lugar.slug }) }}" method="post" {{ form_enctype(form) }}>
				<ul>
					<li>
						<label></label>
						<strong>Cargar fotos desde tu computador</strong>
					</li>
					<li>
						{{form_label(form.firstImg, 'Imagen')}}
						{{form_widget(form.firstImg)}}
					</li>
						
					<li class="opcional" data-placeholder="secondFile">
						<label></label>
						{{form_widget(form.secondImg)}}
						<a href="" class="quitar">Quitar</a>
					</li>

					<li class="opcional" data-placeholder="thirdFile">
						<label></label>
						{{form_widget(form.thirdImg)}}
						<a href="" class="quitar">Quitar</a>
					</li>
					<li id="agregar-file">
						<label></label>
						<a href="">Agregar otra foto</a>
					</li>				
					
								

					<li>
						<label></label>
						<strong>Cargar fotos desde un sitio web</strong>
					</li>


					<li>
						<label>Dirección (URL)</label>
						<input type="text" name="urls[]" />
					</li>

					<li id="secondURL" class="opcional">
						<label></label>
						<input type="text" name="urls[]" />
						<a href="" class="quitar">Quitar</a>
					</li>

					<li id="thirdURL" class="opcional">
						<label></label>
						<input type="text" name="urls[]" />
						<a href="" class="quitar">Quitar</a>
					</li>

					<li id="agregar-url">
						<label></label>
						<a href="">Agregar otra URL</a>
					</li>

					{{form_rest(form)}}

					<li>
						<label></label>
						<input type="submit" value="Enviar" />
					</li>
				</ul>
			</form>
		</div>

	</div>
{% endblock %}

{% block javascripts %}
	{{parent()}}
	<script type="text/javascript">
		$(function(){
			actualizarAgregarMasFotos(1);
			actualizarAgregarMasURLs(1);

			$('#agregar-file a').click(function(e){
				e.preventDefault();
				if($('#form_secondImg').parent().css('display') == 'none') {
					$('#form_secondImg').parent().fadeIn();
					$('#form_secondImg').parent().css('display','list-item');
					actualizarAgregarMasFotos(1);
				}
				else if($('#form_thirdImg').parent().css('display') == 'none') {
					$('#form_thirdImg').parent().fadeIn();
					$('#form_thirdImg').parent().css('display','list-item');
					actualizarAgregarMasFotos(1);
				}
			});

			$('#agregar-url a').click(function(e){
				e.preventDefault();
				if($('#secondURL').css('display') == 'none') {
					$('#secondURL').fadeIn();
					$('#secondURL').css('display','list-item');
					actualizarAgregarMasURLs(1);
				}
				else if($('#thirdURL').css('display') == 'none') {
					$('#thirdURL').fadeIn();
					$('#thirdURL').css('display','list-item');
					actualizarAgregarMasURLs(1);
				}
			});

			$('.quitar').click(function(e){
				e.preventDefault();
				if($(this).parent().attr('data-placeholder') == 'secondFile') {					
					$(this).parent().fadeOut('fast',function(){
						$(this).css('display','none');
						actualizarAgregarMasFotos(0);
					});
				}
				else if($(this).parent().attr('data-placeholder') == 'thirdFile') {
					$(this).parent().fadeOut('fast',function(){
						$(this).css('display','none');
						actualizarAgregarMasFotos(0);
					});
				}
				else if($(this).parent().attr('id') == 'secondURL') {
					$(this).parent().fadeOut('fast',function(){
						$(this).css('display','none');
						actualizarAgregarMasURLs(0);
					});
				}
				else if($(this).parent().attr('id') == 'thirdURL') {
					$(this).parent().fadeOut('fast',function(){
						$(this).css('display','none');
						actualizarAgregarMasURLs(0);
					});
				}
			});

			function actualizarAgregarMasFotos(mas) {
				i = 0;
				$('ul li input[type=file]').each(function(){
					if($(this).parent().css('display') == 'none')
						i++;
				});

				if(mas) {
					if(i >= 1)
						$('#agregar-file a').html('Agregar otra foto (Máx. '+i+')');
					else
						$('#agregar-file a').fadeOut('fast');
				}
				else {
					$('#agregar-file a').html('Agregar otra foto (Máx. '+i+')');
					$('#agregar-file a').fadeIn('fast');
				}
			}

			function actualizarAgregarMasURLs(mas) {
				i = 0;
				$('ul li input[type=text]').each(function(){
					if($(this).parent().css('display') == 'none')
						i++;
				});

				if(mas) {
					if(i >= 1)
						$('#agregar-url a').html('Agregar otra URL (Máx. '+i+')');
					else
						$('#agregar-url a').fadeOut('fast');
				}
				else {
					$('#agregar-url a').html('Agregar otra URL (Máx. '+i+')');
					$('#agregar-url a').fadeIn('fast');
				}
			}
		});

	</script>
{% endblock %}