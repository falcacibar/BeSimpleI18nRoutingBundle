{% extends "::base.html.twig" %}

{% block title %}{{((tipo == 'lugar') ? 'compartir.lugar.mail.title' : 'compartir.recomendacion.mail.title')|trans({'%lugar%' : lugar.nombre})}} | {{parent()}}{% endblock %}

{% block content %}

	<!-- Mensajes de error --> 
	{% if errors %}
		<div class="mensaje_error">
			<div class="imagen_error"></div>
			<div class="txt_error">
				{% for error in errors %}
			        <p>{{ error | trans}}</p>
			    {% endfor %}
		    </div>
		</div>
	{% endif %}	

	<div class="enviar_lugar">
		<h1 class="titulo">
			{% if tipo == 'lugar'%}
				{{'compartir.lugar.mail.titulo'|trans}} 
			{% else %}
				{% set param = (recomendacion.usuario.slug is not empty) ? recomendacion.usuario.slug : recomendacion.usuario.id %}
				{% trans with {'%open_tag%' : "<a href='"~path('_recomendacion', {'slug' : lugar.slug, 'usuarioSlug' : param})~"'>", '%close_tag%' : "</a>", '%usuario%' : "<a href="~path('showUsuario', {'param' : param})~">"~recomendacion.usuario.nombre~" "~recomendacion.usuario.apellido~"</a>" }%}compartir.recomendacion.mail.titulo{% endtrans %}
			{% endif %}
			<a href="{{path('_lugar', {'slug' : lugar.slug})}}">{{lugar.nombre}}</a>
		</h1>

		{% set ruta = (tipo == 'lugar') ? path('_enviarLugar', { 'slug' : lugar.slug }) : path('_enviarRecomendacion', { 'slug' : lugar.slug, 'usuarioSlug' : ((recomendacion.usuario.slug is not empty) ? recomendacion.usuario.slug : recomendacion.usuario.id) })%}
		<form action="{{ ruta }}" method="post">
				<ul>
					{% if not is_granted('ROLE_USER') %}
					<li>
						<label>{{'compartir.form.nombre'|trans}}</label>
						<input type="text" name="nombre" class="{{errors.nombre is defined ? 'input-error' : ' '}}"/>
						{% if errors.nombre is defined %}
							<small class="errors">{{errors.nombre|trans}}</small>
						{% endif %}
					</li>

					<li>
						<label>{{'compartir.form.mail'|trans}}</label>
						<input type="text" name="mail" class="{{errors.mail is defined ? 'input-error' : ' '}}"/>
						{% if errors.mail is defined %}
							<small class="errors">{{errors.mail|trans}}</small>
						{% endif %}
					</li>
					{% endif %}

					<li class="separacion_chica">
						<label>{{'compartir.form.mails_amigos'|trans}}</label>
						<input type="text" name="mails" class="{{errors.mails is defined ? 'input-error' : ' '}}"/>
						{% if errors.mails is defined %}
							<small class="errors">{{errors.mails|trans}}</small>
						{% endif %}
					</li>

					<li>
						<label></label>
						<span class="tips">{{'compartir.form.tips.comas'|trans}}</span>
					</li>

					<li class="separacion_chica">
						<label>{{'compartir.form.cuerpo'|trans}}</label>
						<textarea rows="8" name="cuerpo" placeholder="{{(tipo == 'lugar') ? 'compartir.lugar.placeholder'|trans : 'compartir.recomendacion.placeholder'|trans}}"></textarea>
					</li>

					<li>
						<label></label>
						<span class="tips">{{'compartir.form.tips.obligatorio'|trans}}</span>
					</li>

					<li class="submit">
						<label></label>
						<input class="enviar_mail" type="submit" value=""/>
					</li>
				</ul>
			</form>
	</div>
{% endblock %}

{% block javascripts %}
{{parent()}}
	<script type="text/javascript">
		$('#enviar_lugar form ul li textarea').each(function(){
			$(this).placeholder();
		});

		$('.submit input').click(function(){
			$('#enviar_lugar form ul li textarea').each(function(){
				if($(this).attr('placeholder') == $(this).val()){
					$(this).val('');
				};
			});
		});
	</script>
{% endblock %}