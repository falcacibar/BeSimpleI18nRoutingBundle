{% extends '::base.html.twig' %}

{% block title %}{{post.titulo}} | {{parent()}}{% endblock %}


{% block meta %}
	<meta property="og:title" content="{{ post.titulo }} | {{post.lugar.comuna.ciudad.nombre}} | Loogares.com" />
	<meta property="og:description" content="{{post.preview | striptags}}" />
	<meta property="og:image" content="{{ asset('assets/images/blog/'~post.imagen) }}" />
{% endblock %}

{% block content %}
	<div class="post_concurso">
		<div class="columna_izq">
			<div class="titulo_caja">
				<h1 class="titulo_concurso">{{post.titulo}}</h1>
				<div class="concurso_boton" data-id="{{concurso.id}}">
					{% if "now"|date('U') > concurso.fechaTermino|date('U') %}
						<div class="boton_cerrado"></div>
					{% else %}
						{% if concurso.participa ==  true %}
							<div class="boton_participando"></div>
						{% else %}	
								{# Si está loggeado, puede participar, sino, se muestra popup de registro #}				
								<a {% if is_granted('ROLE_USER')%}class="boton_participar" href="{{path('concurso_compartir', {'ciudad' : post.ciudad.slug, 'slug' : post.slug})}}"{% else %}class="boton_registro" href="{{path('concurso_registro', {'ciudad' : post.ciudad.slug, 'slug' : post.slug})}}"{% endif %}></a>
						{% endif %}
					{% endif %}
				</div>
			</div>

			<div class="tiempo_restante">
				Quedan <span class="tiempo_azul"></span> para participar
			</div>
			{% include "LoogaresBlogBundle:Default:participantes.html.twig"%}
			{% if concurso.ganadores | length > 0 %}
				<div class="ganadores">
					<h4 class="titulo_ganadores">¡Ganadores!</h4>
					<p class="texto_ganadores">Los afortunados Loogareños que participaron del concurso y resultaron ganadores son:</p>
					<ul>
						{% for ganador in concurso.ganadores %}
							<li>
								<a href="{{path('showUsuario', {'param' : ganador.participante.usuario.slug})}}">
									<img src="{{ ('assets/images/usuarios/'~ganador.participante.usuario.imagenFull) | apply_filter('small_usuario') }}" width="20" height="20" />
									<span class="nombre_ganador">{{ganador.participante.usuario.nombre}} {{ganador.participante.usuario.apellido}}</span>
								</a>
							</li>
						{% endfor %}
					</ul>
					<p class="texto_ganadores">Los contactaremos vía E-mail. ¡Felicitaciones! ¡Gracias a todos los que participaron y sigan escribiendo recomendaciones para los próximos concursos!</p>
				</div>
			{% endif %}	

			<div class="redes_sociales_concurso">
				<p>Comparte este concurso con tus amigos</p>
				<ul class="redes_listado">
				<li>
					<a href="https://twitter.com/share" class="twitter-share-button" data-url="{{ url('post', {'ciudad': post.ciudad.slug, 'slug': post.slug}) }}" data-text="{{post.titulo}} {{ url('post', {'ciudad': post.ciudad.slug, 'slug': post.slug}) }}" data-lang="es" data-hashtags="Loogarescom">{{'general.footer.redes.tweet'|trans}}</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
				</li>
				<li>
					<div class="fb-like" data-href="{{ url('post', {'ciudad': post.ciudad.slug, 'slug': post.slug}) }}" data-send="false" data-layout="button_count" data-width="80" data-show-faces="false" data-font="arial"></div>
				</li>
			</ul>
			</div>

			<div class="datos_lugar_concurso">
				<h4 class="sobre_lugar">Sobre {{post.lugar.nombre}}</h4>
				<p>{{post.lugar.calle}} {{post.lugar.numero}}, {{post.lugar.comuna.nombre}}, {{post.lugar.comuna.ciudad.nombre}}</p>
				<p>{{post.lugar.telefonos|join(', ')}}</p>
				{% if post.lugar.sitioWeb != ''%}
					<a class="sitio_web_lugar" href="http://{{post.lugar.sitioWeb}}" target="blank">{{post.lugar.sitioWeb}}</a>
				{% endif %}
				{% if post.lugar.facebook != ''%}
					<a class="facebook_lugar" href="http://{{post.lugar.facebook}}" target="blank"></a>
				{% endif %}
				{% if post.lugar.twitter != ''%}
					<a class="twitter_lugar" href="http://{{post.lugar.twitter}}" target="blank"></a>
				{% endif %}
				<p class="link_ficha_lugar">Visita su ficha en Loogares.com <a href="{{path('_lugar', {'slug' : post.lugar.slug})}}" target="_blank">acá</a></p>
			</div>
		</div>

		<div class="columna_der">

			<img class="imagen_concurso" src="{{asset('assets/images/blog/'~post.imagen)}}" width="530" height="300"/>
		
			<div class="contenido_concurso">
				{{post.contenido | raw}}
			</div>

			<div class="detalle_condiciones_concurso">
				<strong>Detalles del premio:</strong><br />
				{{post.detalles | raw}}
				<br />
				<strong>Condiciones:</strong><br />
				{{post.condiciones | raw}}
			</div>
		</div>
	</div>

	<!-- Concursos del sitio -->
	{% if concursos | length > 0 %}
		{% include "LoogaresExtraBundle:Default:concursos_activos.html.twig" %}
	{% endif %}
{% endblock %}

{% block javascripts %}
	<script src="{{asset('assets/js/jquery.bxSlider.min.js')}}"></script>
	<script src="{{asset('assets/js/jquery.fancybox.pack.js')}}"></script>  
	<script src='{{asset('assets/js/jquery.countdown.min.js')}}'></script>	
	<script src='{{asset('assets/js/concurso.js')}}'></script>
	<script>
		$(function(){
			$('.tiempo_azul').countdown({until: new Date({{concurso.fechaTermino|date('U')}}*1000), layout: '{d<}{dn} días, {d>}{h<}{hn} horas, {h>}{m<}{mn} minutos y {m>}{s<}{sn} segundos{s>}'});

			var interval = setInterval("checkEstadoConcurso(Math.round((new Date()).getTime() / 1000), {{concurso.fechaTermino|date('U')}});",1000);
		});		
	</script>
{% endblock %}